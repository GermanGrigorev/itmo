<!DOCTYPE html>
<html>
  <head>
    <title>Weather</title>
    <style>
      .weatherCard {
        border: 1px solid green;
        padding: 10px;
        margin: 10px;
      }
    </style>
    <script>
      function renderWeatherCard(name, temp) {
        const template = document.getElementById("weatherTemplate");

        const clone = template.content.cloneNode(true);
        const tempField = clone.querySelector(".temp");
        tempField.innerText = temp;
        const nameField = clone.querySelector(".name");
        nameField.innerText = name;
        document.body.appendChild(clone);
      }

      async function getCurrentPositionAsync() {
        return new Promise((resolve, reject) => {
          navigator.geolocation.getCurrentPosition(
            resolve,
            reject
          );
        });
      }

      window.addEventListener("load", () => {
        // код программы
        const moscowCta = document.getElementById("moscowCta");
        // погода в москве
        moscowCta.addEventListener("click", async () => {
          const data = await fetch(
            "https://api.openweathermap.org/data/2.5/weather?q=Moscow&appid=71d31aa0fa80b76923fd889e32f0d07f&units=metric&lang=ru"
          );
          const json = await data.json();
          const temp = json.main.temp;
          const name = json.name;
          renderWeatherCard(name, temp);
        });

        const currentLocCta = document.getElementById("currentLocCta");
        // погода у нас
        currentLocCta.addEventListener("click", async () => {
          const currentPos = await getCurrentPositionAsync();

          const coords = currentPos.coords;
          const lat = coords.latitude;
          const lon = coords.longitude;
          const data = await fetch(
            `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=71d31aa0fa80b76923fd889e32f0d07f&units=metric&lang=ru`
          );
          const json = await data.json();
          console.log("local weather", json);
          const temp = json.main.temp;
          const name = json.name;

          renderWeatherCard(name, temp);
        });
      });
    </script>
  </head>
  <body>
    <main>
      <button id="moscowCta" class="">Погода в Москве</button>
      <button id="currentLocCta" class="">Погода у нас</button>
    </main>
    <template id="weatherTemplate">
      <div class="weatherCard">
        <div>Город: <span class="name"></span></div>
        <div>Температура: <span class="temp"></span></div>
      </div>
    </template>
  </body>
</html>
